<% /* Set the title and other variables for the layout */ %>
<% title = 'Level Manager' %>

<style>
.alert {
    padding: 1rem;
    border-radius: 0.5rem;
    margin-bottom: 1rem;
}

.alert-success {
    background-color: rgba(16, 185, 129, 0.2);
    border: 1px solid rgba(16, 185, 129, 0.5);
    color: var(--success-color);
}

.alert-error {
    background-color: rgba(239, 68, 68, 0.2);
    border: 1px solid rgba(239, 68, 68, 0.5);
    color: var(--error-color);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-link {
    color: var(--text-color);
    font-weight: 500;
    transition: all 0.2s;
}

.tab-link:hover {
    color: var(--accent-color);
}

.tab-link.active {
    color: var(--accent-color);
    border-color: var(--accent-color) !important;
}

.form-select, .form-input, .form-textarea {
    width: 100%;
    padding: 0.75rem;
    background-color: var(--input-background);
    border: 1px solid var(--divider-color);
    border-radius: 0.375rem;
    color: var(--text-color);
    transition: border-color 0.2s;
}

.form-select:focus, .form-input:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px rgba(214, 163, 57, 0.2);
}

.form-group label {
    color: var(--text-color);
    font-weight: 500;
}

.form-group p {
    color: rgba(215, 221, 243, 0.7);
}
</style>

<div class="py-16">
    <div class="container mx-auto px-4">
        <h1 class="text-4xl font-display font-bold text-center mb-8">Level Manager</h1>
        <p class="text-center text-lg mb-12 max-w-2xl mx-auto">Use this tool to add levels to trainers and monsters.</p>

        <% if (typeof message !== 'undefined' && message) { %>
        <div class="alert alert-<%= messageType || 'success' %> text-center mb-8 max-w-2xl mx-auto">
            <%= message %>
        </div>
        <% } %>
    </div>
</div>

<main class="container mx-auto px-4 pb-16">
    <div class="card max-w-2xl mx-auto shadow-2xl">
        <div class="card-header">
            <h2 class="text-2xl font-bold">Add Levels</h2>
            <p class="text-sm mt-2 opacity-80">Use this tool to manually add levels to trainers or monsters.</p>
        </div>
        <div class="card-body">
            <!-- Tabs -->
            <div class="mb-6 border-b border-divider">
                <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                    <li class="mr-6">
                        <a href="#" class="tab-link inline-block p-4 border-b-2 rounded-t-lg active" data-tab="trainer-tab">
                            Level Up Trainer
                        </a>
                    </li>
                    <li class="mr-6">
                        <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg" data-tab="monster-tab">
                            Level Up Monster
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Trainer Tab Content -->
            <div id="trainer-tab" class="tab-content active">
                <form action="/admin/level-manager/trainer" method="POST" class="space-y-6">
                    <div class="form-group">
                        <label for="trainer-select" class="block mb-2">Select Trainer</label>
                        <select id="trainer-select" name="trainer_id" class="form-select" required>
                            <option value="">-- Select a Trainer --</option>
                            <% trainers.forEach(trainer => { %>
                                <option value="<%= trainer.id %>"><%= trainer.name %> (Level <%= trainer.level %>)</option>
                            <% }); %>
                        </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="trainer-levels" class="block mb-2">Levels to Add</label>
                            <input type="number" id="trainer-levels" name="levels" min="1" max="100" value="1" class="form-input" required>
                            <p class="text-xs mt-1">Enter the number of levels to add (1-100)</p>
                        </div>

                        <div class="form-group">
                            <label for="trainer-coins" class="block mb-2">Coins to Add</label>
                            <input type="number" id="trainer-coins" name="coins" min="0" value="50" class="form-input" required>
                            <p class="text-xs mt-1">Enter the number of coins to add</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="trainer-reason" class="block mb-2">Reason (Optional)</label>
                        <textarea id="trainer-reason" name="reason" class="form-textarea" rows="2" placeholder="Reason for adding levels"></textarea>
                    </div>

                    <div class="form-group mt-8">
                        <button type="submit" class="btn-primary w-full py-3">Add Levels to Trainer</button>
                    </div>
                </form>
            </div>

            <!-- Monster Tab Content -->
            <div id="monster-tab" class="tab-content">
                <form action="/admin/level-manager/monster" method="POST" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="trainer-filter" class="block mb-2">Filter by Trainer</label>
                            <select id="trainer-filter" class="form-select">
                                <option value="">-- All Trainers --</option>
                                <% trainers.forEach(trainer => { %>
                                    <option value="<%= trainer.id %>"><%= trainer.name %></option>
                                <% }); %>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="monster-select" class="block mb-2">Select Monster</label>
                            <select id="monster-select" name="monster_id" class="form-select" required>
                                <option value="">-- Select a Monster --</option>
                                <% monsters.forEach(monster => { %>
                                    <option value="<%= monster.mon_id %>" data-trainer="<%= monster.trainer_id %>">
                                        <%= monster.name %> (<%= monster.species1 %><%= monster.species2 ? '/' + monster.species2 : '' %>) - Level <%= monster.level %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="monster-levels" class="block mb-2">Levels to Add</label>
                            <input type="number" id="monster-levels" name="levels" min="1" max="100" value="1" class="form-input" required>
                            <p class="text-xs mt-1">Enter the number of levels to add (1-100)</p>
                        </div>

                        <div class="form-group">
                            <label for="monster-coins" class="block mb-2">Coins to Add to Trainer</label>
                            <input type="number" id="monster-coins" name="coins" min="0" value="50" class="form-input" required>
                            <p class="text-xs mt-1">Enter the number of coins to add</p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="monster-reason" class="block mb-2">Reason (Optional)</label>
                        <textarea id="monster-reason" name="reason" class="form-textarea" rows="2" placeholder="Reason for adding levels"></textarea>
                    </div>

                    <div class="form-group mt-8">
                        <button type="submit" class="btn-primary w-full py-3">Add Levels to Monster</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();

            // Remove active class from all tabs
            tabLinks.forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('border-transparent');
            });

            // Add active class to clicked tab
            this.classList.add('active');
            this.classList.remove('border-transparent');

            // Hide all tab contents
            tabContents.forEach(content => content.classList.remove('active'));

            // Show the selected tab content
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // Filter monsters by trainer
    const trainerFilter = document.getElementById('trainer-filter');
    const monsterSelect = document.getElementById('monster-select');
    const monsterOptions = Array.from(monsterSelect.options);

    trainerFilter.addEventListener('change', function() {
        const selectedTrainerId = this.value;

        // Remove all current options
        while (monsterSelect.options.length > 0) {
            monsterSelect.remove(0);
        }

        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.text = '-- Select a Monster --';
        defaultOption.value = '';
        monsterSelect.add(defaultOption);

        // Filter and add matching options
        monsterOptions.forEach(option => {
            if (option.value === '') return; // Skip the default option

            const trainerId = option.getAttribute('data-trainer');
            if (!selectedTrainerId || trainerId === selectedTrainerId) {
                monsterSelect.add(option.cloneNode(true));
            }
        });
    });

    // Auto-calculate coins based on levels for trainer
    const trainerLevels = document.getElementById('trainer-levels');
    const trainerCoins = document.getElementById('trainer-coins');

    trainerLevels.addEventListener('input', function() {
        trainerCoins.value = this.value * 50;
    });

    // Auto-calculate coins based on levels for monster
    const monsterLevels = document.getElementById('monster-levels');
    const monsterCoins = document.getElementById('monster-coins');

    monsterLevels.addEventListener('input', function() {
        monsterCoins.value = this.value * 50;
    });

    // Add animation to form submission
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function() {
            const button = this.querySelector('button[type="submit"]');
            if (button) {
                button.textContent = 'Processing...';
                button.disabled = true;
            }
        });
    });
});
</script>