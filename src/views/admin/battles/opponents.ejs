<%- include('./battle-styles') %>

<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-yellow-400">Battle Opponents</h1>
    <a href="/admin/battles/opponents/new" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
      <i class="fas fa-plus mr-2"></i> New Opponent
    </a>
  </div>

  <% if (typeof message !== 'undefined' && message) { %>
    <div class="bg-<%= messageType === 'error' ? 'red' : 'green' %>-800 text-white p-4 rounded-lg mb-6">
      <%= message %>
      <% if (messageType === 'error' && message.includes('migration')) { %>
        <div class="mt-4">
          <a href="/admin/battles/run-migration" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-4 rounded">
            Run Battle System Migration
          </a>
        </div>
      <% } %>
    </div>
  <% } %>

  <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
    <div class="overflow-x-auto">
      <table class="min-w-full bg-gray-700 rounded-lg">
        <thead>
          <tr>
            <th class="px-4 py-2 text-left text-gray-300">ID</th>
            <th class="px-4 py-2 text-left text-gray-300">Name</th>
            <th class="px-4 py-2 text-left text-gray-300">Difficulty</th>
            <th class="px-4 py-2 text-left text-gray-300">Level</th>
            <th class="px-4 py-2 text-left text-gray-300">Type</th>
            <th class="px-4 py-2 text-left text-gray-300">Status</th>
            <th class="px-4 py-2 text-left text-gray-300">Monsters</th>
            <th class="px-4 py-2 text-left text-gray-300">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (opponents && opponents.length > 0) { %>
            <% opponents.forEach(opponent => { %>
              <tr class="border-t border-gray-600">
                <td class="px-4 py-2 text-gray-300"><%= opponent.opponent_id %></td>
                <td class="px-4 py-2 text-white"><%= opponent.name %></td>
                <td class="px-4 py-2">
                  <span class="px-2 py-1 rounded text-xs font-bold
                    <% if (opponent.difficulty === 'easy') { %>bg-green-600 text-white<% } %>
                    <% if (opponent.difficulty === 'normal') { %>bg-blue-600 text-white<% } %>
                    <% if (opponent.difficulty === 'hard') { %>bg-orange-600 text-white<% } %>
                    <% if (opponent.difficulty === 'elite') { %>bg-red-600 text-white<% } %>
                  ">
                    <%= opponent.difficulty.toUpperCase() %>
                  </span>
                </td>
                <td class="px-4 py-2 text-gray-300"><%= opponent.level %></td>
                <td class="px-4 py-2 text-gray-300"><%= opponent.type || '-' %></td>
                <td class="px-4 py-2">
                  <% if (opponent.is_active) { %>
                    <span class="text-green-400">Active</span>
                  <% } else { %>
                    <span class="text-red-400">Inactive</span>
                  <% } %>
                </td>
                <td class="px-4 py-2 text-center">
                  <a href="/admin/battles/opponents/<%= opponent.opponent_id %>" class="text-blue-400 hover:text-blue-300">
                    View Team
                  </a>
                </td>
                <td class="px-4 py-2">
                  <div class="flex space-x-2">
                    <a href="/admin/battles/opponents/<%= opponent.opponent_id %>/edit" class="text-blue-400 hover:text-blue-300">
                      <i class="fas fa-edit"></i>
                    </a>
                    <button onclick="confirmDelete(<%= opponent.opponent_id %>, '<%= opponent.name %>')" class="text-red-400 hover:text-red-300">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            <% }); %>
          <% } else { %>
            <tr>
              <td colspan="8" class="px-4 py-4 text-center text-gray-400">No opponents found</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function confirmDelete(opponentId, opponentName) {
    if (confirm(`Are you sure you want to delete the opponent "${opponentName}"? This action cannot be undone.`)) {
      window.location.href = `/admin/battles/opponents/${opponentId}/delete`;
    }
  }
</script>
