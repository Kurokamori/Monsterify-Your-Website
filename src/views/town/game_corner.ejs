<% /* Set the title and other variables for the layout */ %>
<% title = 'Pomodoro Game Corner' %>

<!-- Main Container -->
<div class="container mx-auto px-4" style="min-height: 90vh;">
  <div class="flex items-center mb-4 w-full justify-between">
    <a href="/town/visit" class="btn-secondary mr-4 hover:scale-105 transition-transform">
      <i class="fas fa-arrow-left mr-2"></i> Back to Town
    </a>
  </div>

  <!-- Message notification section -->
  <% if (typeof message !== 'undefined' && message) { %>
    <div class="notification <%= messageType === 'error' ? 'bg-red-800/70' : 'bg-green-800/70' %> text-white p-4 rounded-lg mb-4 flex items-center justify-between">
      <div>
        <i class="<%= messageType === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle' %> mr-2"></i>
        <%= message %>
      </div>
      <button class="text-white hover:text-gray-200" onclick="this.parentElement.style.display='none'">
        <i class="fas fa-times"></i>
      </button>
    </div>
  <% } %>

  <!-- Main Content Area with Collapsible Sections -->
  <div class="w-full max-w-screen-2xl mx-auto px-4">
    <!-- Grid Container with fixed height -->
    <div class="grid grid-cols-4 gap-6" style="min-height: 80vh;">
      <!-- Video Player Section (75%) -->
      <div class="col-span-3">
        <div class="bg-gray-800 rounded-lg shadow-lg h-full flex flex-col">
          <div class="flex justify-between items-center p-4" id="video-header">
            <h3 class="text-xl font-bold text-white">Pomodoro Videos</h3>
            <div class="flex items-center space-x-3">
              <button id="expand-video" class="btn-secondary p-2">
                <i class="fas fa-expand"></i>
              </button>
              <button id="collapse-video" class="btn-secondary p-2 hidden">
                <i class="fas fa-compress"></i>
              </button>
            </div>
          </div>
          <div id="video-content" class="flex-grow">
            <div class="relative h-full">
              <div id="video-container" class="w-full h-full bg-gray-900 relative">
              </div>
              <div class="video-controls p-5 bg-gray-900/90 backdrop-blur-sm absolute bottom-0 left-0 right-0 border-t border-gray-800">
                <div class="flex justify-center">
                  <div class="text-xs text-gray-400 video-time">00:00 / 00:00</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Timer Section (25%) -->
      <div class="col-span-1">
        <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-xl overflow-hidden h-full flex flex-col">
          <!-- Timer Display with Progress Circle -->
          <div class="p-4 pt-6">
            <!-- Progress Circle Container -->
            <div class="timer-circle-wrapper">
              <div class="timer-circle">
                <!-- SVG Progress Circle -->
                <svg viewBox="0 0 100 100">
                  <circle cx="50" cy="50" r="45" fill="none" stroke="#1f2937" stroke-width="6"/>
                  <circle id="progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#8b5cf6" stroke-width="6"
                          stroke-dasharray="282.7" stroke-dashoffset="0"/>
                </svg>

                <!-- Timer Display -->
                <div class="timer-display">
                  <span id="timer-display">25:00</span>
                  <span id="session-info" class="text-xs block mt-1">Session 1</span>
                  <span id="timer-mode-indicator" class="text-xxs block mt-1 badge badge-primary">Work</span>
                </div>
              </div>
            </div>

            <!-- Timer Status -->
            <div class="mb-4">
              <div id="timer-status" class="text-center text-sm">Ready to start</div>
            </div>

            <!-- Timer Controls -->
            <div class="flex justify-between w-full space-x-2">
              <button id="start-timer" class="btn-primary h-10 text-sm flex-1 flex items-center justify-center"
                      title="Start timer (Space)">
                <i class="fas fa-play mr-1"></i> Start
              </button>
              <button id="pause-timer" class="btn-secondary h-10 text-sm flex-1 flex items-center justify-center"
                      title="Pause timer (Space)">
                <i class="fas fa-pause mr-1"></i> Pause
              </button>
              <button id="reset-timer" class="btn-danger h-10 text-sm flex-1 flex items-center justify-center"
                      title="Reset timer (R key)">
                <i class="fas fa-redo mr-1"></i> Reset
              </button>
            </div>
            <div class="text-center mt-2">
              <span class="text-gray-400 text-xxs">Shortcuts: Space = Start/Pause, R = Reset</span>
            </div>
          </div>

          <!-- Timer Settings -->
          <div class="border-t border-gray-700">
            <div class="px-4 py-3 space-y-3 bg-gray-800/30">
              <div class="form-group">
                <label for="timer-duration" class="text-sm text-gray-300">Session Duration (minutes)</label>
                <div class="flex items-center space-x-2">
                  <button id="decrement-duration" class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i
                            class="fas fa-minus"></i></button>
                  <input type="number" id="timer-duration" class="flex-1 text-center" value="25" min="1" max="60">
                  <button id="increment-duration" class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i
                            class="fas fa-plus"></i></button>
                </div>
              </div>
              <div class="form-group">
                <label for="break-duration" class="text-sm text-gray-300">Break Duration (minutes)</label>
                <div class="flex items-center space-x-2">
                  <button id="decrement-break-duration"
                          class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i
                            class="fas fa-minus"></i></button>
                  <input type="number" id="break-duration" class="flex-1 text-center" value="5" min="1" max="30">
                  <button id="increment-break-duration"
                          class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              <div class="form-group">
                <label for="session-count-input" class="text-sm text-gray-300">Session Count</label>
                <div class="flex items-center space-x-2">
                  <button id="decrement-session-count"
                          class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i
                            class="fas fa-minus"></i></button>
                  <input type="number" id="session-count-input" class="flex-1 text-center" value="4" min="1" max="10">
                  <button id="increment-session-count"
                          class="btn-secondary p-1 h-8 w-8 flex items-center justify-center"><i class="fas fa-plus"></i>
                  </button>
                </div>
                <div class="flex items-center mt-1">
                  <span class="text-gray-400 text-xs">Current: </span>
                  <span id="session-count" class="text-white ml-1">1</span>
                  <span class="text-gray-400 text-xs ml-1">/ </span>
                  <span id="total-sessions" class="text-white ml-1">4</span>
                </div>
              </div>

              <!-- Custom Video Controls -->
              <div class="border-t border-gray-700 mt-4">
                <div class="px-4 py-3 space-y-3 bg-gray-800/30">
                  <div class="form-group">
                    <label class="text-sm text-gray-300">Video Controls</label>
                    <div class="flex items-center justify-between mt-2">
                      <button id="play-pause-video"
                              class="text-white hover:text-purple-400 p-2 bg-gray-800/60 rounded-full h-10 w-10 flex items-center justify-center transition-all hover:bg-gray-700/80">
                        <i class="fas fa-play"></i>
                      </button>
                      <div class="flex items-center space-x-3 bg-gray-800/60 px-3 py-2 rounded-full flex-grow ml-3">
                        <i id="volume-icon" class="fas fa-volume-up text-gray-300"></i>
                        <input type="range" id="volume-slider" min="0" max="100" value="100"
                               class="w-full custom-slider">
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="custom-video-url" class="text-sm text-gray-300">Custom YouTube Video</label>
                    <div class="flex items-center space-x-0">
                      <input type="text" id="custom-video-url" placeholder="Enter YouTube ID or URL"
                             class="flex-1 rounded-l-md border-r-0">
                      <button id="load-custom-video"
                              class="bg-purple-700 hover:bg-purple-600 text-white p-2 rounded-r-md border border-purple-600 text-sm transition-colors h-[40px]">
                        Load
                      </button>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="video-selector" class="text-sm text-gray-300">Preset Videos</label>
                    <select id="video-selector"
                            class="w-full bg-gray-800/80 text-white text-sm rounded-md p-2 border border-gray-700">
                      <option value="m1vtEX64gmE">Pokémon Lofi Music Mix</option>
                      <option value="wDA4kdgC0bc">Lofi Pokémon Radio</option>
                      <option value="ceHXUTnOlDc">Nostalgic Pokémon Gen 2 Lofi</option>
                      <option value="yiDBPX3HLt8">Relaxing Digimon Lofi Music</option>
                      <option value="xqM8L6-dCn0">Digimon World Lofi</option>
                      <option value="FcQ3te3q-wk">Pokémon Red/Blue/Yellow Lofi</option>
                      <option value="t1e93jDEEPg">Pokémon Ruby/Sapphire Lofi</option>
                      <option value="osPAyYnKzUM">Pokémon Diamond/Pearl Lofi</option>
                      <option value="QKFo94582Jk">Pokémon Black/White Lofi</option>
                      <option value="xcmll5HhJRY">Digimon Adventure Lofi</option>
                      <option value="cwETZT6Cb1A">Digimon Tamers Lofi</option>
                      <option value="uzIo80t4iXc">Digimon Frontier Lofi</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="/css/game_corner.css">

<style>
  /* Additional styles for video player */
  .grid {
    min-height: 600px !important;
  }
</style>

<script>
  // This script is intentionally left empty as all timer functions are now handled in game_corner.js
  // The timer functions are exposed globally in game_corner.js and can be accessed as:
  // window.startTimer, window.pauseTimer, window.resetTimer
  // or window.startTimerGlobal, window.pauseTimerGlobal, window.resetTimerGlobal
</script>

<script src="/js/game_corner.js"></script>
