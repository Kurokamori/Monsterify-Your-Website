<div class='container mx-auto px-4 py-8'>
  <div class='max-w-4xl mx-auto'>
    <div class='mb-8 text-center'>
      <h1 class='text-3xl font-display font-bold'><%= pageTitle || 'Rewards' %></h1>
      <p class='text-gray-300 mt-2'><%= pageSubtitle || 'You\'ve earned the following rewards:' %></p>
    </div>

    <div class='bg-gray-800 rounded-lg p-6 shadow-lg mb-8'>
      <!-- Summary Section Removed -->

      <!-- Trainer Selection (if not pre-assigned) -->
      <% if (typeof allowTrainerSelection !== 'undefined' && allowTrainerSelection && trainers && trainers.length > 0) { %>
        <div class="mb-6 p-4 bg-gray-700/50 rounded-lg border border-purple-500/20">
          <h3 class="text-xl font-bold text-white mb-2">Select Trainer</h3>
          <p class="text-gray-300 text-sm mb-3">Choose which trainer will receive these rewards:</p>
          <select id="trainer-selector" class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg p-2">
            <option value="random">Random Assignment</option>
            <% trainers.forEach(trainer => { %>
              <option value="<%= trainer.id %>"><%= trainer.name %> (Level <%= trainer.level || '1' %>)</option>
            <% }); %>
          </select>
        </div>
      <% } %>

      <!-- Rewards Grid -->
      <div class='rewards-list'>
        <% if (rewards && rewards.length > 0) { %>
          <% rewards.forEach(reward => { %>
            <div class='reward-item <%= reward.rarity %>'>
              <% if (reward.type === 'monster') { %>
                <div class='monster-reward'>
                  <div class='reward-icon'>
                    <i class='<%= reward.icon || "fas fa-dragon" %>'></i>
                  </div>
                  <div class='reward-details'>
                    <h3 class='reward-title' style="line-height: 1.3;">
                      <%= reward.data.species || reward.data.name || "Monster" %>
                      <% if (reward.data.species2) { %>
                        / <%= reward.data.species2 %>
                      <% } %>
                      <% if (reward.data.species3) { %>
                        / <%= reward.data.species3 %>
                      <% } %>
                    </h3>
                    <p class='reward-description'>Level <%= reward.data.level || 1 %></p>
                    <div class="mt-2 mb-3">
                      <!-- Type Badges -->
                      <div class="flex flex-wrap gap-1 mb-2">
                        <%
                        // Define type colors
                        const typeColors = {
                          'Normal': { bg: 'bg-gray-400', text: 'text-gray-800' },
                          'Fire': { bg: 'bg-red-500', text: 'text-white' },
                          'Water': { bg: 'bg-blue-500', text: 'text-white' },
                          'Electric': { bg: 'bg-yellow-400', text: 'text-gray-800' },
                          'Grass': { bg: 'bg-green-500', text: 'text-white' },
                          'Ice': { bg: 'bg-blue-200', text: 'text-gray-800' },
                          'Fighting': { bg: 'bg-red-700', text: 'text-white' },
                          'Poison': { bg: 'bg-purple-500', text: 'text-white' },
                          'Ground': { bg: 'bg-yellow-600', text: 'text-white' },
                          'Flying': { bg: 'bg-indigo-300', text: 'text-gray-800' },
                          'Psychic': { bg: 'bg-pink-500', text: 'text-white' },
                          'Bug': { bg: 'bg-green-600', text: 'text-white' },
                          'Rock': { bg: 'bg-yellow-700', text: 'text-white' },
                          'Ghost': { bg: 'bg-purple-700', text: 'text-white' },
                          'Dragon': { bg: 'bg-indigo-600', text: 'text-white' },
                          'Dark': { bg: 'bg-gray-800', text: 'text-white' },
                          'Steel': { bg: 'bg-gray-500', text: 'text-white' },
                          'Fairy': { bg: 'bg-pink-300', text: 'text-gray-800' },
                          'Light': { bg: 'bg-yellow-200', text: 'text-gray-800' },
                          'Sound': { bg: 'bg-purple-400', text: 'text-white' },
                          'Cosmic': { bg: 'bg-indigo-800', text: 'text-white' }
                        };

                        // Get all types - handle both lowercase and uppercase property names
                        const types = [
                          reward.data.type || reward.data.type1 || reward.data.Type || reward.data.Type1 || "Normal",
                          reward.data.type2 || reward.data.Type2,
                          reward.data.type3 || reward.data.Type3,
                          reward.data.type4 || reward.data.Type4,
                          reward.data.type5 || reward.data.Type5
                        ].filter(Boolean);

                        // Display type badges
                        types.forEach(type => {
                          const typeStyle = typeColors[type] || { bg: 'bg-gray-600', text: 'text-white' };
                        %>
                          <span class="type-badge <%= typeStyle.bg %> <%= typeStyle.text %>">
                            <%= type %>
                          </span>
                        <% }); %>
                      </div>

                      <!-- Attribute Badge -->
                      <%
                      // Define attribute colors
                      const attributeColors = {
                        'Vaccine': { bg: 'bg-blue-600', text: 'text-white', icon: 'fas fa-shield-alt' },
                        'Data': { bg: 'bg-green-600', text: 'text-white', icon: 'fas fa-database' },
                        'Virus': { bg: 'bg-red-600', text: 'text-white', icon: 'fas fa-virus' },
                        'Free': { bg: 'bg-purple-600', text: 'text-white', icon: 'fas fa-wind' },
                        'Unknown': { bg: 'bg-gray-600', text: 'text-white', icon: 'fas fa-question' }
                      };

                      const attribute = reward.data.attribute || "Data";
                      const attrStyle = attributeColors[attribute] || attributeColors['Unknown'];
                      %>
                      <div class="flex items-center">
                        <span class="attribute-badge <%= attrStyle.bg %> <%= attrStyle.text %>">
                          <i class="<%= attrStyle.icon %>"></i>
                          <%= attribute %>
                        </span>
                        <span class="text-xs text-gray-400 ml-2">Attribute</span>
                      </div>
                    </div>

                    <% if (reward.assigned) { %>
                      <div class="assigned-badge">
                        <p>Assigned to <span class="trainer-name"><%= reward.assignedTo.name %></span></p>
                      </div>
                    <% } else { %>
                      <button class='btn-primary mt-3 w-full' data-reward-id='<%= reward.id %>' data-reward-type='monster'>
                        <i class='fas fa-plus-circle mr-1'></i> Claim Monster
                      </button>
                    <% } %>
                  </div>
                </div>
              <% } else if (reward.type === 'item') { %>
                <div class='item-reward'>
                  <div class='reward-icon'>
                    <i class='<%= reward.icon || "fas fa-box" %>'></i>
                  </div>
                  <div class='reward-details'>
                    <h3 class='reward-title'><%= reward.data.name || "Item" %></h3>
                    <p class='reward-description'><%= reward.data.description || "" %></p>
                    <p class='reward-quantity'>Quantity: <%= reward.data.quantity || 1 %></p>

                    <% if (reward.assigned) { %>
                      <div class="assigned-badge">
                        <p>Assigned to <span class="trainer-name"><%= reward.assignedTo.name %></span></p>
                      </div>
                    <% } else { %>
                      <button class='btn-primary mt-3 w-full' data-reward-id='<%= reward.id %>' data-reward-type='item'>
                        <i class='fas fa-plus-circle mr-1'></i> Claim Item
                      </button>
                    <% } %>
                  </div>
                </div>
              <% } else if (reward.type === 'coin') { %>
                <div class='coin-reward'>
                  <div class='reward-icon'>
                    <i class='<%= reward.icon || "fas fa-coins" %>'></i>
                  </div>
                  <div class='reward-details'>
                    <h3 class='reward-title'><%= reward.data.title || "Coins" %></h3>
                    <p class='reward-quantity'><%= reward.data.amount || 0 %> coins</p>

                    <% if (reward.assigned) { %>
                      <div class="assigned-badge">
                        <p>Assigned to <span class="trainer-name"><%= reward.assignedTo.name %></span></p>
                      </div>
                    <% } else { %>
                      <button class='btn-primary mt-3 w-full' data-reward-id='<%= reward.id %>' data-reward-type='coin'>
                        <i class='fas fa-plus-circle mr-1'></i> Claim Coins
                      </button>
                    <% } %>
                  </div>
                </div>
              <% } else if (reward.type === 'level') { %>
                <div class='level-reward'>
                  <div class='reward-icon'>
                    <i class='<%= reward.icon || "fas fa-level-up-alt" %>'></i>
                  </div>
                  <div class='reward-details'>
                    <% if (reward.data.trainerLevelUp) { %>
                      <!-- Trainer Level Up -->
                      <h3 class='reward-title'><%= reward.data.title || "Trainer Level Up" %></h3>
                      <div class="trainer-level-highlight">
                        <p>Trainer gained <%= reward.data.levels || 1 %> level(s)!</p>
                      </div>
                      <p class='reward-quantity'>+<%= reward.data.levels || 1 %> trainer levels</p>
                    <% } else { %>
                      <!-- Monster Level Up -->
                      <h3 class='reward-title'><%= reward.data.title || "Monster Level Up" %></h3>
                      <% if (reward.data.monsterName) { %>
                        <% if (reward.data.monsterNameHighlight) { %>
                          <div class="monster-level-highlight">
                            <p><%= reward.data.monsterName %> leveled up!</p>
                          </div>
                        <% } else { %>
                          <p class='reward-description font-semibold'><%= reward.data.monsterName %> leveled up!</p>
                        <% } %>
                      <% } %>
                      <p class='reward-quantity'>+<%= reward.data.levels || 1 %> monster levels</p>
                    <% } %>

                    <% if (reward.assigned) { %>
                      <div class="assigned-badge">
                        <% if (reward.data.smallTrainerName) { %>
                          <p>Assigned to <span class="trainer-name"><%= reward.assignedTo.name %></span></p>
                        <% } else { %>
                          <p>Assigned to <span class="trainer-name"><%= reward.assignedTo.name %></span></p>
                        <% } %>
                      </div>
                    <% } else { %>
                      <button class='btn-primary mt-3 w-full' data-reward-id='<%= reward.id %>' data-reward-type='level'>
                        <i class='fas fa-plus-circle mr-1'></i> Apply Levels
                      </button>
                    <% } %>
                  </div>
                </div>
              <% } else { %>
                <!-- Generic reward type -->
                <div class='generic-reward'>
                  <div class='reward-icon'>
                    <i class='<%= reward.icon || "fas fa-gift" %>'></i>
                  </div>
                  <div class='reward-details'>
                    <h3 class='reward-title'><%= reward.data.title || reward.data.name || "Reward" %></h3>
                    <p class='reward-description'><%= reward.data.description || "" %></p>

                    <% if (reward.assigned) { %>
                      <div class="bg-gray-700/50 p-2 rounded-lg mt-3 text-center">
                        <p class="text-xs text-gray-300">Assigned to <%= reward.assignedTo.name %></p>
                      </div>
                    <% } else { %>
                      <button class='btn-primary mt-3 w-full' data-reward-id='<%= reward.id %>' data-reward-type='<%= reward.type %>'>
                        <i class='fas fa-plus-circle mr-1'></i> Claim Reward
                      </button>
                    <% } %>
                  </div>
                </div>
              <% } %>
            </div>
          <% }); %>
        <% } else { %>
          <p class='text-center text-gray-400'>No rewards found. Try again later!</p>
        <% } %>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-center space-x-4">
      <% if (typeof returnUrl !== 'undefined' && returnUrl) { %>
        <a href="<%= returnUrl %>" class="btn-secondary">
          <i class="fas fa-arrow-left mr-2"></i> <%= returnButtonText || 'Go Back' %>
        </a>
      <% } %>

      <% if (typeof showClaimAllButton !== 'undefined' && showClaimAllButton) { %>
        <button id="claim-all-rewards" class="btn-primary">
          <i class="fas fa-check-circle mr-2"></i> Claim All Rewards
        </button>
      <% } %>

      <a href="/town/visit" class="btn-primary">
        <i class="fas fa-home mr-2"></i> Return to Town
      </a>
    </div>
  </div>
</div>

<style>
  .rewards-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .reward-item {
    background-color: rgba(31, 41, 55, 0.5);
    border-radius: 0.5rem;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    border: 2px solid transparent;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    height: 100%;
    width: 100%;
    overflow: hidden;
    word-wrap: break-word;
  }

  .reward-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .reward-item.common {
    border-color: #9e9e9e;
  }

  .reward-item.uncommon {
    border-color: #4caf50;
  }

  .reward-item.rare {
    border-color: #2196f3;
  }

  .reward-item.epic {
    border-color: #9c27b0;
  }

  .reward-item.legendary {
    border-color: #ff9800;
    box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
    animation: legendaryPulse 2s infinite;
  }

  @keyframes legendaryPulse {
    0% { box-shadow: 0 0 10px rgba(255, 152, 0, 0.5); }
    50% { box-shadow: 0 0 20px rgba(255, 152, 0, 0.8); }
    100% { box-shadow: 0 0 10px rgba(255, 152, 0, 0.5); }
  }

  .monster-reward, .item-reward, .coin-reward, .level-reward, .generic-reward {
    display: flex;
    gap: 1rem;
    height: 100%;
    min-width: 0; /* Allows flex children to shrink below their minimum content size */
  }

  .reward-icon {
    width: 50px;
    height: 50px;
    min-width: 50px;
    background-color: rgba(139, 92, 246, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #8b5cf6;
  }

  .coin-reward .reward-icon {
    background-color: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
  }

  .item-reward .reward-icon {
    background-color: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }

  .level-reward .reward-icon {
    background-color: rgba(59, 130, 246, 0.2);
    color: #3b82f6;
  }

  .generic-reward .reward-icon {
    background-color: rgba(236, 72, 153, 0.2);
    color: #ec4899;
  }

  .reward-details {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0; /* Allows content to shrink below minimum content size */
    overflow: hidden; /* Prevents content from overflowing */
  }

  .reward-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: white;
    margin-bottom: 0.25rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }

  .reward-description, .reward-quantity {
    font-size: 0.875rem;
    color: #d1d5db;
    margin-bottom: 0.5rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Type and Attribute Badges */
  .type-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    margin-right: 0.25rem;
    margin-bottom: 0.25rem;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .attribute-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 500;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .attribute-badge i {
    margin-right: 0.25rem;
  }

  /* Monster Level-Up Highlight */
  .monster-level-highlight {
    background-color: rgba(139, 92, 246, 0.15);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: 0.375rem;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    color: #c4b5fd;
    font-weight: 500;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Trainer Level-Up Highlight */
  .trainer-level-highlight {
    background-color: rgba(59, 130, 246, 0.15);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 0.375rem;
    padding: 0.5rem;
    margin-bottom: 0.5rem;
    color: #93c5fd;
    font-weight: 500;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Assigned Badge */
  .assigned-badge {
    background-color: rgba(75, 85, 99, 0.3);
    border-radius: 0.375rem;
    padding: 0.5rem;
    margin-top: auto;
    text-align: center;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .assigned-badge p {
    font-size: 0.75rem;
    color: #9ca3af;
    white-space: normal;
  }

  .assigned-badge .trainer-name {
    color: #d1d5db;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Filter and sort controls */
  .reward-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .reward-filter {
    background-color: rgba(31, 41, 55, 0.7);
    border: 1px solid rgba(75, 85, 99, 0.5);
    border-radius: 0.375rem;
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
    color: white;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .reward-filter:hover {
    background-color: rgba(55, 65, 81, 0.7);
  }

  .reward-filter.active {
    background-color: rgba(139, 92, 246, 0.3);
    border-color: rgba(139, 92, 246, 0.5);
  }

  /* Animation for newly claimed rewards */
  @keyframes claimSuccess {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .claim-success {
    animation: claimSuccess 0.5s ease;
  }

  /* Make claim buttons stick to bottom */
  .btn-primary, .btn-secondary {
    margin-top: auto;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get trainer selector if it exists
    const trainerSelector = document.getElementById('trainer-selector');
    let selectedTrainerId = 'random';

    if (trainerSelector) {
      trainerSelector.addEventListener('change', function() {
        selectedTrainerId = this.value;
      });
    }

    // Handle claim buttons
    const claimButtons = document.querySelectorAll('[data-reward-id]');

    claimButtons.forEach(button => {
      button.addEventListener('click', async function() {
        const rewardId = this.getAttribute('data-reward-id');
        const rewardType = this.getAttribute('data-reward-type');
        const rewardItem = this.closest('.reward-item');

        try {
          // Disable button to prevent multiple clicks
          this.disabled = true;
          this.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Processing...';

          // Call API to process the reward
          // Determine the API endpoint based on the source
          const apiEndpoint = '<%= source %>' === 'activity'
            ? '/api/activity/claim-reward'
            : '/api/game-corner/claim-reward';

          // Add session ID for activity rewards
          const extraParams = '<%= source %>' === 'activity'
            ? { sessionId: new URLSearchParams(window.location.search).get('session_id') }
            : {};

          const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              rewardId,
              rewardType,
              trainerId: selectedTrainerId,
              source: '<%= source || "game_corner" %>',
              ...extraParams
            })
          });

          const data = await response.json();

          if (data.success) {
            // Add success animation
            rewardItem.classList.add('claim-success');

            // Update button to show claimed
            this.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Claimed';
            this.classList.remove('btn-primary');
            this.classList.add('btn-success');

            // If we have trainer info, show it
            if (data.trainerName) {
              const buttonParent = this.parentElement;
              buttonParent.innerHTML = `
                <div class="bg-gray-700/50 p-2 rounded-lg text-center">
                  <p class="text-xs text-gray-300">Assigned to ${data.trainerName}</p>
                </div>
              `;
            }

            // Show toast notification if available
            if (typeof showToast === 'function') {
              showToast('success', data.message || 'Reward claimed successfully!');
            }
          } else {
            // Show error and re-enable button
            this.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i> Error';
            this.classList.remove('btn-primary');
            this.classList.add('btn-danger');

            // Show toast notification if available
            if (typeof showToast === 'function') {
              showToast('error', data.message || 'Failed to claim reward');
            }

            setTimeout(() => {
              this.innerHTML = '<i class="fas fa-plus-circle mr-1"></i> Try Again';
              this.classList.remove('btn-danger');
              this.classList.add('btn-primary');
              this.disabled = false;
            }, 2000);
          }
        } catch (error) {
          console.error('Error claiming reward:', error);
          this.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i> Error';
          this.classList.remove('btn-primary');
          this.classList.add('btn-danger');

          // Show toast notification if available
          if (typeof showToast === 'function') {
            showToast('error', 'Network error. Please try again.');
          }

          setTimeout(() => {
            this.innerHTML = '<i class="fas fa-plus-circle mr-1"></i> Try Again';
            this.classList.remove('btn-danger');
            this.classList.add('btn-primary');
            this.disabled = false;
          }, 2000);
        }
      });
    });

    // Handle claim all button
    const claimAllButton = document.getElementById('claim-all-rewards');
    if (claimAllButton) {
      claimAllButton.addEventListener('click', async function() {
        // Get all unclaimed rewards
        const unclaimedButtons = document.querySelectorAll('[data-reward-id]:not(:disabled)');

        if (unclaimedButtons.length === 0) {
          if (typeof showToast === 'function') {
            showToast('info', 'No rewards left to claim');
          }
          return;
        }

        // Disable the claim all button
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Processing...';

        // Get all reward IDs and types
        const rewards = Array.from(unclaimedButtons).map(button => ({
          id: button.getAttribute('data-reward-id'),
          type: button.getAttribute('data-reward-type')
        }));

        try {
          // Determine the API endpoint based on the source
          const apiEndpoint = '<%= source %>' === 'activity'
            ? '/api/activity/claim-all-rewards'
            : '/api/game-corner/claim-all-rewards';

          // Add session ID for activity rewards
          const extraParams = '<%= source %>' === 'activity'
            ? { sessionId: new URLSearchParams(window.location.search).get('session_id') }
            : {};

          // Call API to process all rewards
          const response = await fetch(apiEndpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              rewards,
              trainerId: selectedTrainerId,
              source: '<%= source || "game_corner" %>',
              ...extraParams
            })
          });

          const data = await response.json();

          if (data.success) {
            // Update all buttons to show claimed
            unclaimedButtons.forEach(button => {
              const rewardItem = button.closest('.reward-item');
              rewardItem.classList.add('claim-success');

              button.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Claimed';
              button.classList.remove('btn-primary');
              button.classList.add('btn-success');
              button.disabled = true;

              // If we have trainer info for this reward, show it
              const rewardId = button.getAttribute('data-reward-id');
              const claimedReward = data.claimedRewards.find(r => r.id === rewardId);

              if (claimedReward && claimedReward.trainerName) {
                const buttonParent = button.parentElement;
                buttonParent.innerHTML = `
                  <div class="bg-gray-700/50 p-2 rounded-lg text-center">
                    <p class="text-xs text-gray-300">Assigned to ${claimedReward.trainerName}</p>
                  </div>
                `;
              }
            });

            // Update claim all button
            this.innerHTML = '<i class="fas fa-check-circle mr-1"></i> All Claimed';
            this.classList.remove('btn-primary');
            this.classList.add('btn-success');

            // Show toast notification if available
            if (typeof showToast === 'function') {
              showToast('success', data.message || 'All rewards claimed successfully!');
            }
          } else {
            // Show error and re-enable button
            this.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i> Error';
            this.classList.remove('btn-primary');
            this.classList.add('btn-danger');

            // Show toast notification if available
            if (typeof showToast === 'function') {
              showToast('error', data.message || 'Failed to claim rewards');
            }

            setTimeout(() => {
              this.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Claim All Rewards';
              this.classList.remove('btn-danger');
              this.classList.add('btn-primary');
              this.disabled = false;
            }, 2000);
          }
        } catch (error) {
          console.error('Error claiming all rewards:', error);
          this.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i> Error';
          this.classList.remove('btn-primary');
          this.classList.add('btn-danger');

          // Show toast notification if available
          if (typeof showToast === 'function') {
            showToast('error', 'Network error. Please try again.');
          }

          setTimeout(() => {
            this.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Claim All Rewards';
            this.classList.remove('btn-danger');
            this.classList.add('btn-primary');
            this.disabled = false;
          }, 2000);
        }
      });
    }

    // Simple toast notification function if not already defined
    if (typeof window.showToast !== 'function') {
      window.showToast = function(type, message) {
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
          toastContainer = document.createElement('div');
          toastContainer.id = 'toast-container';
          toastContainer.style.position = 'fixed';
          toastContainer.style.bottom = '20px';
          toastContainer.style.right = '20px';
          toastContainer.style.zIndex = '9999';
          document.body.appendChild(toastContainer);
        }

        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.style.backgroundColor = type === 'success' ? 'rgba(16, 185, 129, 0.9)' :
                                     type === 'error' ? 'rgba(239, 68, 68, 0.9)' :
                                     'rgba(59, 130, 246, 0.9)';
        toast.style.color = 'white';
        toast.style.padding = '12px 16px';
        toast.style.borderRadius = '6px';
        toast.style.marginTop = '10px';
        toast.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        toast.style.display = 'flex';
        toast.style.alignItems = 'center';
        toast.style.minWidth = '300px';
        toast.style.transform = 'translateY(20px)';
        toast.style.opacity = '0';
        toast.style.transition = 'transform 0.3s ease, opacity 0.3s ease';

        // Add icon based on type
        const icon = document.createElement('i');
        icon.className = type === 'success' ? 'fas fa-check-circle' :
                       type === 'error' ? 'fas fa-exclamation-circle' :
                       'fas fa-info-circle';
        icon.style.marginRight = '12px';
        icon.style.fontSize = '20px';

        // Add message
        const messageEl = document.createElement('span');
        messageEl.textContent = message;

        // Add close button
        const closeBtn = document.createElement('button');
        closeBtn.innerHTML = '&times;';
        closeBtn.style.marginLeft = 'auto';
        closeBtn.style.background = 'none';
        closeBtn.style.border = 'none';
        closeBtn.style.color = 'white';
        closeBtn.style.fontSize = '20px';
        closeBtn.style.cursor = 'pointer';
        closeBtn.style.padding = '0 0 0 12px';
        closeBtn.onclick = function() {
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(20px)';
          setTimeout(() => {
            toast.remove();
          }, 300);
        };

        // Assemble toast
        toast.appendChild(icon);
        toast.appendChild(messageEl);
        toast.appendChild(closeBtn);

        // Add to container
        toastContainer.appendChild(toast);

        // Animate in
        setTimeout(() => {
          toast.style.transform = 'translateY(0)';
          toast.style.opacity = '1';
        }, 10);

        // Auto remove after 5 seconds
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(20px)';
          setTimeout(() => {
            toast.remove();
          }, 300);
        }, 5000);
      };
    }
  });
</script>

