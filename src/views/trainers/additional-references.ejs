<% /* Set the title and other variables for the layout */ %>
<% title = title || `${trainer.name} - Additional References` %>
<div class="full-width-section">
    <div class="container">
        <span></span>
    </div>
</div>

<div class="full-width-content">
    <div class="trainer-page-layout">
        <!-- Side Navigation -->
        <div class="trainer-sidebar">
            <div class="sidebar-nav">
                <a href="/trainers/<%= trainer.id %>" class="sidebar-link">Profile</a>
                <a href="/trainers/<%= trainer.id %>/pc" class="sidebar-link">PC Boxes</a>
                <a href="/trainers/<%= trainer.id %>/boxes" class="sidebar-link">All Boxes</a>
                <a href="/trainers/<%= trainer.id %>/inventory" class="sidebar-link">Inventory</a>
                <a href="/trainers/<%= trainer.id %>/stats" class="sidebar-link">Stats</a>
                <a href="/trainers/<%= trainer.id %>/achievements" class="sidebar-link">Achievements</a>
                <a href="/trainers/<%= trainer.id %>/additional-references" class="sidebar-link active">Additional References</a>

                <% if (locals.user && locals.user.discord_id && trainer.player_user_id && locals.user.discord_id.toString() === trainer.player_user_id) { %>
                <div class="sidebar-divider"></div>
                <a href="/trainers/<%= trainer.id %>/edit" class="sidebar-link owner-action">Edit Trainer</a>
                <a href="/trainers/<%= trainer.id %>/edit-boxes" class="sidebar-link owner-action">Edit Boxes</a>

                <% if (typeof all_monsters !== 'undefined' && all_monsters && all_monsters.length < 3) { %>
                <a href="/trainers/<%= trainer.id %>/roll-starters" class="sidebar-link owner-action highlight">Roll Starters</a>
                <% } %>
                <% } %>
            </div>
        </div>

        <!-- Main Content -->
        <div class="trainer-main-content">
            <div class="trainer-header">
                <h1 class="text-4xl font-display font-bold mb-4"><%= trainer.name %>'s Additional References</h1>
            </div>

            <div class="references-container">
                <% if (references && references.length > 0) { %>
                    <div class="references-grid">
                        <% references.forEach(reference => { %>
                            <div class="reference-card <%= reference.type === 'text' ? 'text-only' : '' %>">
                                <% if (reference.type !== 'text') { %>
                                <div class="reference-image">
                                    <img src="<%= reference.img_url || '/images/default_trainer.png' %>"
                                         alt="<%= reference.title || 'Reference Image' %>"
                                         onerror="this.src='/images/default_trainer.png'">
                                    <% if (reference.artist) { %>
                                    <div class="image-credit">Art by: <%= reference.artist %></div>
                                    <% } %>
                                </div>
                                <% } %>
                                <div class="reference-info">
                                    <h3 class="reference-title"><%= reference.title || 'Reference' %></h3>
                                    <% if (reference.description) { %>
                                    <p class="reference-description"><%= reference.description %></p>
                                    <% } %>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } else { %>
                    <div class="empty-references">
                        <p>No additional references have been added yet.</p>
                        <% if (locals.user && locals.user.discord_id && trainer.player_user_id && locals.user.discord_id.toString() === trainer.player_user_id) { %>
                        <p class="mt-4">You can add additional references from the Edit Trainer page.</p>
                        <a href="/trainers/<%= trainer.id %>/edit" class="btn-primary mt-4">Edit Trainer</a>
                        <% } %>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<style>
/* Main layout containers */
.full-width-section {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    padding: 3rem 0;
    background-image: linear-gradient(to bottom, rgba(30, 37, 50, 0.8), rgba(17, 19, 25, 0.9));
}

.full-width-content {
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* Trainer Page Layout */
.trainer-page-layout {
    display: flex;
    gap: 1.5rem;
    position: relative;
}

.trainer-sidebar {
    flex: 0 0 180px;
    align-self: flex-start;
}

.trainer-main-content {
    flex: 1;
    min-width: 0;
}

.sidebar-nav {
    background: rgba(30, 37, 50, 0.7);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
}

.sidebar-link {
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    color: var(--text-color);
    text-decoration: none;
    transition: all 0.2s ease;
    font-weight: 500;
    font-size: 0.95rem;
}

.sidebar-link:hover {
    background: var(--nav-hover);
}

.sidebar-link.active {
    background: var(--nav-active);
    color: var(--accent-color);
}

.sidebar-divider {
    height: 1px;
    background: var(--divider-color);
    margin: 0.75rem 0;
}

.owner-action {
    border-left: 3px solid var(--accent-color);
}

.owner-action.highlight {
    background: rgba(214, 163, 57, 0.2);
}

.owner-action.highlight:hover {
    background: rgba(214, 163, 57, 0.3);
}

/* References Styling */
.references-container {
    margin-top: 2rem;
}

.references-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
}

.reference-card {
    background: rgba(30, 37, 50, 0.5);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease;
}

.reference-card:hover {
    transform: translateY(-5px);
}

.reference-image {
    position: relative;
    height: 250px;
    overflow: hidden;
}

.reference-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.reference-card:hover .reference-image img {
    transform: scale(1.05);
}

.image-credit {
    position: absolute;
    bottom: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: rgba(255, 255, 255, 0.8);
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
    border-top-left-radius: 8px;
}

.reference-info {
    padding: 1.5rem;
}

.reference-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.reference-description {
    font-size: 0.95rem;
    opacity: 0.8;
    line-height: 1.6;
}

.reference-card.text-only {
    background: rgba(30, 37, 50, 0.7);
}

.reference-card.text-only .reference-info {
    padding: 2rem;
}

.empty-references {
    text-align: center;
    padding: 4rem 2rem;
    background: rgba(30, 37, 50, 0.3);
    border-radius: 12px;
    color: var(--text-color);
    opacity: 0.8;
}

.btn-primary {
    display: inline-block;
    background-color: var(--accent-color);
    color: #000;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
}

.btn-primary:hover {
    background-color: #c49ef7;
    transform: translateY(-2px);
}

.mt-4 {
    margin-top: 1rem;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .trainer-page-layout {
        flex-direction: column;
    }

    .trainer-sidebar {
        position: static;
        width: 100%;
    }

    .references-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .references-grid {
        grid-template-columns: 1fr;
    }
}
</style>
